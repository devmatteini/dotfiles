#!/usr/bin/env python3

from installer import Package, create_installer, join

def bash_completion_path_for(file_name: str) -> str:
    return f'~/.local/share/bash-completion/completions/{file_name}'

INSTALL_FZF = [
    'git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf',
    '~/.fzf/install --key-bindings --completion --no-update-rc'
]

# https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
INSTALL_AWS = [
    'curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"',
    'unzip -u awscliv2.zip',
    './aws/install --install-dir ~/.local/aws-cli --bin-dir ~/.local/bin',
    "rm -rf awscliv2.zip aws/",
    # create bash completion file
    f"""cat > {bash_completion_path_for("aws")} <<EOL
#/usr/bin/env bash
complete -C ~/.local/bin/aws_completer aws
EOL"""
]

INSTALL_TLDR = [
    'dra download -s tealdeer-linux-x86_64-musl -o ~/.local/bin/tldr dbrgn/tealdeer',
    'chmod +x ~/.local/bin/tldr',
    # Download bash completion
    f'dra download -s completions_bash -o {bash_completion_path_for("tldr")} dbrgn/tealdeer'
]

create_installer("tools", [
    # https://github.com/junegunn/fzf
    Package("fzf", join(INSTALL_FZF)),

    # https://github.com/koalaman/shellcheck
    Package("shellcheck", "sudo apt install -y shellcheck"),

    # https://github.com/dbrgn/tealdeer
    Package("tldr", join(INSTALL_TLDR)),

    # https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html
    Package("aws", join(INSTALL_AWS)),

    # https://github.com/sharkdp/bat
    Package("bat", 'dra download -i -s "bat-v{tag}-x86_64-unknown-linux-gnu.tar.gz" -o ~/.local/bin sharkdp/bat'),

    # https://github.com/BurntSushi/ripgrep
    Package("rg", 'dra download -i -s "ripgrep-{tag}-x86_64-unknown-linux-musl.tar.gz" -o ~/.local/bin BurntSushi/ripgrep'),

    # https://github.com/starship/starship
    Package("starship", "dra download -s starship-x86_64-unknown-linux-gnu.tar.gz -i -o ~/.local/bin starship/starship"),

    # https://github.com/direnv/direnv
    Package("direnv", "sudo apt install -y direnv"),
])()


# thefuck https://github.com/nvbn/thefuck
# pip3 install thefuck

# Joplin https://github.com/laurent22/joplin
# wget -O - https://raw.githubusercontent.com/laurent22/joplin/master/Joplin_install_and_update.sh | bash
